2025-03-30 07:49:35 - INFO - root.configurarLogging: ==================================================
2025-03-30 07:49:35 - INFO - root.configurarLogging: configurarLogging: Sistema de logging configurado.
2025-03-30 07:49:35 - INFO - root.configurarLogging: configurarLogging: Nivel de log establecido a INFO
2025-03-30 07:49:35 - INFO - root.<module>: Iniciando script principal (Dos Pasos Detallado). Modo Test: Activado
2025-03-30 07:49:35 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: ===== INICIO CICLO DE REFACTORIZACIÓN (ENFOQUE DOS PASOS DETALLADO) =====
2025-03-30 07:49:35 - INFO - root.cargarHistorial: cargarHistorial: Historial cargado desde /var/www/herramientaRefactor/historial_refactor.log (0 entradas).
2025-03-30 07:49:35 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Preparando repositorio local...
2025-03-30 07:49:35 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Gestionando repositorio git@github.com:2upra/v4.git en /var/www/herramientaRefactor/clonProyecto (rama objetivo: refactor-test-7)
2025-03-30 07:49:35 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Verificando y/o corrigiendo URL del remote 'origin'...
2025-03-30 07:49:35 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: URL del remote 'origin' ya está configurada correctamente a git@github.com:2upra/v4.git.
2025-03-30 07:49:36 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Rama principal remota detectada: 'main'
2025-03-30 07:49:36 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Limpiando estado del repositorio local...
2025-03-30 07:49:36 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Actualizando referencias remotas (fetch)...
2025-03-30 07:49:38 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Reseteando rama 'main' a 'origin/main'...
2025-03-30 07:49:38 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Limpiando archivos no rastreados (clean)...
2025-03-30 07:49:38 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Asegurando rama de trabajo: 'refactor-test-7'
2025-03-30 07:49:39 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Creando nueva rama local 'refactor-test-7' desde 'main'.
2025-03-30 07:49:39 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Nueva rama 'refactor-test-7' creada localmente.
2025-03-30 07:49:39 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Repositorio actualizado y en la rama 'refactor-test-7'.
2025-03-30 07:49:39 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Repositorio listo y en la rama 'refactor-test-7'.
2025-03-30 07:49:39 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: --- INICIO PASO 1: ANÁLISIS Y DECISIÓN DETALLADA ---
2025-03-30 07:49:39 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Analizando código COMPLETO del proyecto en /var/www/herramientaRefactor/clonProyecto...
2025-03-30 07:49:39 - INFO - nucleo.analizadorCodigo.listarArchivosProyecto: listarArchivosProyecto: Listando archivos en: /var/www/herramientaRefactor/clonProyecto
2025-03-30 07:49:39 - INFO - nucleo.analizadorCodigo.listarArchivosProyecto: listarArchivosProyecto: Archivos relevantes encontrados: 233
2025-03-30 07:49:39 - INFO - nucleo.analizadorCodigo.leerArchivos: leerArchivos: Leídos 233 archivos. Tamaño total: 1664.14 KB
2025-03-30 07:49:39 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Código fuente completo leído (233 archivos, 1690.72 KB).
2025-03-30 07:49:39 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Obteniendo DECISIÓN DETALLADA de Gemini (modelo: gemini-2.0-flash-thinking-exp-01-21)...
2025-03-30 07:49:39 - INFO - nucleo.analizadorCodigo.configurarGemini: configurarGemini: Cliente de Gemini configurado.
2025-03-30 07:49:39 - INFO - nucleo.analizadorCodigo.obtenerDecisionRefactor: obtenerDecisionRefactor (Paso 1): Usando modelo Gemini: gemini-2.0-flash-thinking-exp-01-21
2025-03-30 07:49:39 - INFO - nucleo.analizadorCodigo.obtenerDecisionRefactor: obtenerDecisionRefactor (Paso 1): Enviando solicitud de DECISIÓN detallada a Gemini...
2025-03-30 07:49:56 - INFO - nucleo.analizadorCodigo.obtenerDecisionRefactor: obtenerDecisionRefactor (Paso 1): Respuesta de DECISIÓN recibida.
2025-03-30 07:49:56 - INFO - nucleo.analizadorCodigo._limpiarYParsearJson: obtenerDecisionRefactor (Paso 1): JSON parseado correctamente.
2025-03-30 07:49:56 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Parseando DECISIÓN DETALLADA de Gemini...
2025-03-30 07:49:56 - INFO - root.parsearDecisionGemini: parsearDecisionGemini: Decisión parseada exitosamente. Acción: mover_funcion. Archivos relevantes: ['TemplateInicio.php', 'TemplateFeedSample.php', 'TemplateBiblioteca.php', 'TemplateBusqueda.php', 'TemplateTask.php', 'functions.php']. Razonamiento: 1. Observación: La función `obtenerIdiomaDelNavegador()` está duplicada en varios archivos de planti...
2025-03-30 07:49:56 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Razonamiento del Paso 1:
1. Observación: La función `obtenerIdiomaDelNavegador()` está duplicada en varios archivos de plantilla (TemplateInicio.php, TemplateFeedSample.php, TemplateBiblioteca.php, TemplateBusqueda.php, TemplateTask.php).
2. Justificación: Mover esta función a `functions.php` centralizará la lógica de detección de idioma, reduciendo la duplicación de código y facilitando el mantenimiento futuro. Esto mejora la cohesión del código al agrupar funciones utilitarias en un lugar común.
3. Acción Específica: Mover la función `obtenerIdiomaDelNavegador()` desde `TemplateInicio.php` a `functions.php`.
4. Impacto Esperado: Se elimina la duplicación de código, mejorando la mantenibilidad y la organización del proyecto. Facilita futuras modificaciones o mejoras en la lógica de detección de idioma.
5. Riesgos/Consideraciones: Bajo riesgo. Se debe asegurar que todos los archivos de plantilla que utilizaban esta función ahora la llamen desde `functions.php`. No se espera que esta acción altere la funcionalidad existente.
6. Código a Eliminar (si aplica): Eliminar la definición de la función `obtenerIdiomaDelNavegador()` de los archivos `TemplateInicio.php`, `TemplateFeedSample.php`, `TemplateBiblioteca.php`, `TemplateBusqueda.php`, `TemplateTask.php`.
2025-03-30 07:49:56 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: --- FIN PASO 1: Decisión válida recibida: mover_funcion ---
2025-03-30 07:49:56 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: --- INICIO PASO 2: EJECUCIÓN PRECISA ---
2025-03-30 07:49:56 - INFO - nucleo.analizadorCodigo.leerArchivos: leerArchivos: Leídos 6 archivos. Tamaño total: 34.62 KB
2025-03-30 07:49:56 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Contexto reducido leído (6 archivos: ['TemplateInicio.php', 'TemplateFeedSample.php', 'TemplateBiblioteca.php', 'TemplateBusqueda.php', 'TemplateTask.php', 'functions.php'], 35.25 KB).
2025-03-30 07:49:56 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Obteniendo RESULTADO de ejecución de Gemini (contexto reducido, siguiendo decisión)...
2025-03-30 07:49:56 - INFO - nucleo.analizadorCodigo.ejecutarAccionConGemini: ejecutarAccionConGemini (Paso 2): Usando modelo Gemini: gemini-2.0-flash-thinking-exp-01-21
2025-03-30 07:49:56 - INFO - nucleo.analizadorCodigo.ejecutarAccionConGemini: ejecutarAccionConGemini (Paso 2): Enviando solicitud de EJECUCIÓN precisa a Gemini...
2025-03-30 07:50:38 - INFO - nucleo.analizadorCodigo.ejecutarAccionConGemini: ejecutarAccionConGemini (Paso 2): Respuesta de EJECUCIÓN recibida.
2025-03-30 07:50:38 - ERROR - nucleo.analizadorCodigo._limpiarYParsearJson: ejecutarAccionConGemini (Paso 2): Error crítico parseando JSON de Gemini: Expecting ',' delimiter: line 5 column 17691 (char 19732)
2025-03-30 07:50:38 - ERROR - nucleo.analizadorCodigo._limpiarYParsearJson: ejecutarAccionConGemini (Paso 2): Respuesta (limpia) que falló:
{
  "tipo_resultado": "ejecucion_cambio",
  "archivos_modificados": {
    "TemplateInicio.php": "<?\n/*\nTemplate Name: Inicio\n*/\n\n// Detectar idioma y definir título y descripción\n$idioma = obtenerIdiomaDelNavegador();\nif ($idioma === 'es') {\n    $titulo = \"Social Media para Artistas | Samples y VST Gratis\";\n    $descripcion = \"Únete a una red de creadores donde puedes conectar con artistas, colaborar en proyectos, y encontrar una amplia variedad de samples y plugins VST gratuitos para potenciar tus producciones musicales.\";\n} else {\n    $titulo = \"Social Media for Artists | Free Samples & VSTs\";\n    $descripcion = \"Join a network of creators where you can connect with artists, collaborate on projects, and access a wide range of free samples and VST plugins to enhance your music productions.\";\n}\n\n// Añadir el título y la descripción al <head>\nadd_action('wp_head', function () use ($titulo, $descripcion) {\n    echo '<title>' . esc_html($titulo) . '</title>' . \"\\n\";\n    echo '<meta name=\"description\" content=\"' . esc_attr($descripcion) . '\">' . \"\\n\";\n}, 1); // Prioridad baja para que se ejecute temprano en wp_head\n\n// Configurar cookies para el título y descripción\nsetcookie(\"page_title\", $titulo, time() + 3600, \"/\");\nsetcookie(\"page_description\", $descripcion, time() + 3600, \"/\");\n?>\n\n<head>\n    <meta name=\"robots\" content=\"index, follow\">\n    <? wp_head(); ?>\n</head>\n\n<?\nget_header();\n$user_id = get_current_user_id();\n$acciones = get_user_meta($user_id, 'acciones', true);\n$nologin_class = !is_user_logged_in() ? ' nologin' : '';\n?>\n\n<div id=\"main\">\n    <div id=\"content\" class=\"<? echo esc_attr($nologin_class); ?>\">\n        <input type=\"hidden\" id=\"pagina_actual\" name=\"pagina_actual\" value=\"<? echo esc_attr(get_the_title()); ?>\">\n        <? if (!is_user_logged_in()): ?>\n            <? echo dev(); ?>\n        <? else: ?>\n            <? echo socialTabs(); ?>\n        <? endif; ?>\n    </div>\n</div>\n\n<?\nget_footer();\n?>",
    "functions.php": "<?\n// Movido automáticamente por IA desde TemplateInicio.php\n// Función para obtener el idioma preferido del navegador\nfunction obtenerIdiomaDelNavegador() {\n    if (!isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])) {\n        return 'en';\n    }\n    $accepted_languages = explode(',', $_SERVER['HTTP_ACCEPT_LANGUAGE']);\n    foreach ($accepted_languages as $language) {\n        $lang = substr($language, 0, 2);\n        if (in_array($lang, ['es', 'en'])) {\n            return $lang;\n        }\n    }\n    return 'en';\n}\n<?\nrequire_once ABSPATH . 'wp-admin/includes/media.php';\nrequire_once ABSPATH . 'wp-admin/includes/file.php';\nrequire_once ABSPATH . 'wp-admin/includes/image.php';\n\n$stripe_init_path = ABSPATH . 'wp-content/stripe/init.php';\n\nif (file_exists($stripe_init_path)) {\n    require_once $stripe_init_path;\n}\n/*\ncomposer install --ignore-platform-reqs\n*/\nrequire_once __DIR__ . '/vendor/autoload.php';\n\ntry {\n    $dotenv = Dotenv\\Dotenv::createImmutable(__DIR__);\n    $dotenv->load();\n} catch (Exception $e) {\n    //error_log('Error al cargar el archivo .env: ' . $e->getMessage());\n    if (!isset($_ENV['DATABASE_HOST'])) {\n        $_ENV['DATABASE_HOST'] = 'localhost';\n        $_ENV['AUDIOCLAVE'] = 'e1d78b9adf3466f98b7e53e1e7f21dfe723b1ccd0f93a09a2b9bdf3905a5fd07';\n    }\n}\n\ndefine('STRIPE_ERROR_ENABLED', true);\ndefine('SEO_LOG_ENABLED', true);\ndefine('GUARDAR_LOG_ENABLED', true);\n\n//\ndefine('LOG_AUDIO_ENABLED', false);\ndefine('RENDIMIENTO_ENABLED', true);\ndefine('CHAT_LOG_ENABLED', false);\ndefine('AUT_LOG_ENABLED', true);\ndefine('LOG_ALGORITMO_ENABLED', false);\ndefine('AJAX_POST_LOG_ENABLED', false);\ndefine('IA_LOG_ENABLED', true);\ndefine('POST_LOG_ENABLED', false);\ndefine('STREAM_LOG_ENABLED', false);\ndefine('INTERES_TABLE', \"{$wpdb->prefix}interes\");\ndefine('POSTINLIMIT', 640);\n/*\nfunction debug_page_load_time() {\n    $time = number_format((microtime(true) - $_SERVER[\"REQUEST_TIME_FLOAT\"]) * 1000, 2);\n    error_log(\"Página cargada en: {$time}ms\");\n}\nadd_action('shutdown', 'debug_page_load_time');\n*/\n\nfunction paginasIniciales1()\n{\n    // Verificar si las páginas ya fueron creadas\n    if (get_option('paginasIniciales1') == '1') return;\n\n\n    if (!defined('LOCAL') || (defined('LOCAL') && LOCAL === false)) {\n        update_option('paginasIniciales1', '1');\n        return;\n    }\n\n\n    $paginas = array(\n        'Inicio' => array(\n            'plantilla' => 'TemplateInicio.php',\n            'contenido' => 'Este es el contenido de la página de inicio.'\n        ),\n        'Colab' => array(\n            'plantilla' => 'TemplateColab.php',\n            'contenido' => ''\n        ),\n        'Dev' => array(\n            'plantilla' => 'TemplateDev.php',\n            'contenido' => ''\n        ),\n        'Colec' => array(\n            'plantilla' => 'TemplateColec.php',\n            'contenido' => ''\n        ),\n        'Feed' => array(\n            'plantilla' => 'TemplateFeed.php',\n            'contenido' => ''\n        ),\n        'FeedSample' => array(\n            'plantilla' => 'TemplateFeedSample.php',\n            'contenido' => ''\n        ),\n        'Inversor' => array(\n            'plantilla' => 'TemplateInversor.php',\n            'contenido' => ''\n        ),\n        'Music' => array(\n            'plantilla' => 'TemplateMusic.php',\n            'contenido' => ''\n        ),\n        'Prueba' => array(\n            'plantilla' => 'TemplatePrueba.php',\n            'contenido' => ''\n        ),\n        'Sample' => array(\n            'plantilla' => 'TemplateSample.php',\n            'contenido' => ''\n        ),\n        'Sello' => array(\n            'plantilla' => 'TemplateSello.php',\n            'contenido' => ''\n        ),\n        'T&Q' => array(\n            'plantilla' => 'TemplateT&Q.php',\n            'contenido' => ''\n        ),\n        'Biblioteca' => array(\n            'plantilla' => 'TemplateBiblioteca.php',\n            'contenido' => ''\n        )\n    );\n\n    // Recorrer el array y crear las páginas\n    $inicio_id = 0; // Variable para guardar el ID de la página de inicio\n    foreach ($paginas as $titulo => $datos) {\n        // Usar WP_Query en lugar de get_page_by_title\n        $pagina_query = new WP_Query(array(\n            'post_type' => 'page',\n            'title'     => $titulo,\n            'post_status' => 'any'\n        ));\n\n        if (!$pagina_query->have_posts()) {\n            $nueva_pagina = array(\n                'post_title'    => $titulo,\n                'post_content'  => $datos['contenido'],\n                'post_status'   => 'publish',\n                'post_type'     => 'page',\n                'page_template' => $datos['plantilla']\n            );\n\n            $nueva_pagina_id = wp_insert_post($nueva_pagina);\n\n            // Si la página creada es la de inicio, guardar su ID\n            if ($titulo == 'Inicio') {\n                $inicio_id = $nueva_pagina_id;\n            }\n        }\n\n        // Liberar memoria\n        wp_reset_postdata();\n    }\n\n    // Definir la página de inicio\n    if ($inicio_id > 0) {\n        update_option('show_on_front', 'page');\n        update_option('page_on_front', $inicio_id);\n    }\n\n    // Marcar que las páginas ya fueron creadas\n    update_option('paginasIniciales1', '1');\n}\n\nadd_action('init', 'paginasIniciales1');\n\n\nfunction headGeneric()\n{\n    if (!defined('LOCAL') || (defined('LOCAL') && LOCAL === true)) {\n        update_option('paginasIniciales1', '1');\n        return;\n    }\n?>\n\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <link rel=\"icon\" href=\"https://2upra.com/favicon.ico\" type=\"image/x-icon\">\n    <link rel=\"apple-touch-icon\" sizes=\"57x57\" href=\"https://2upra.com/apple-icon-57x57.png\">\n    <link rel=\"apple-touch-icon\" sizes=\"60x60\" href=\"https://2upra.com/apple-icon-60x60.png\">\n    <link rel=\"apple-touch-icon\" sizes=\"72x72\" href=\"https://2upra.com/apple-icon-72x72.png\">\n    <link rel=\"apple-touch-icon\" sizes=\"76x76\" href=\"https://2upra.com/apple-icon-76x76.png\">\n    <link rel=\"apple-touch-icon\" sizes=\"114x114\" href=\"https://2upra.com/apple-icon-114x114.png\">\n    <link rel=\"apple-touch-icon\" sizes=\"120x120\" href=\"https://2upra.com/apple-icon-120x120.png\">\n    <link rel=\"apple-touch-icon\" sizes=\"144x144\" href=\"https://2upra.com/apple-icon-144x144.png\">\n    <link rel=\"apple-touch-icon\" sizes=\"152x152\" href=\"https://2upra.com/apple-icon-152x152.png\">\n    <link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"https://2upra.com/apple-icon-180x180.png\">\n    <link rel=\"icon\" type=\"image/png\" sizes=\"192x192\" href=\"https://2upra.com/android-icon-192x192.png\">\n    <link rel=\"icon\" type=\"image/png\" sizes=\"32x32\" href=\"https://2upra.com/favicon-32x32.png\">\n    <link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"https://2upra.com/favicon-96x96.png\">\n    <link rel=\"icon\" type=\"image/png\" sizes=\"16x16\" href=\"https://2upra.com/favicon-16x16.png\">\n    <link rel=\"manifest\" href=\"https://2upra.com/manifest.json\">\n    <meta name=\"msapplication-TileColor\" content=\"#ffffff\">\n    <meta name=\"msapplication-TileImage\" content=\"https://2upra.com/ms-icon-144x144.png\">\n    <meta name=\"theme-color\" content=\"#ffffff\">\n\n    <!-- Etiquetas Open Graph para Facebook y otras plataformas -->\n    <meta property=\"og:title\" content=\"<? echo get_the_title(); ?>\" />\n    <meta property=\"og:description\" content=\"Social Media para artistas\" />\n    <meta property=\"og:image\" content=\"https://i0.wp.com/2upra.com/wp-content/uploads/2024/11/Pinterest_Download-47-28-818x1024.jpg?quality=60&strip=all\" />\n    <meta property=\"og:url\" content=\"https://2upra.com\" />\n    <meta property=\"og:type\" content=\"website\" />\n\n    <!-- Etiquetas de Twitter Cards -->\n    <meta property=\"og:title\" content=\"<? echo get_the_title(); ?>\" />\n    <meta name=\"twitter:title\" content=\"Social Media para artistas\">\n    <meta name=\"twitter:description\" content=\"Descripción de tu página que aparecerá al compartir.\">\n    <meta name=\"twitter:image\" content=\"https://i0.wp.com/2upra.com/wp-content/uploads/2024/11/Pinterest_Download-47-28-818x1024.jpg?quality=60&strip=all\">\n    <meta name=\"twitter:site\" content=\"@wandorius\" />\n\n<?\n}\nadd_action('wp_head', 'headGeneric');\n\nfunction preload_fonts()\n{\n    if (!defined('LOCAL') || (defined('LOCAL') && LOCAL === true)) {\n        return;\n    }\n    echo '<link rel=\"preload\" href=\"https://2upra.com/wp-content/themes/2upra3v/assets/Fonts/SourceSans3-Regular.woff2\" as=\"font\" type=\"font/woff2\" crossorigin>';\n    echo '<link rel=\"preload\" href=\"https://2upra.com/wp-content/themes/2upra3v/assets/Fonts/SourceSans3-Bold.woff2\" as=\"font\" type=\"font/woff2\" crossorigin>';\n}\nadd_action('wp_head', 'preload_fonts', 1);\n\n\n/*\nfunction encolar_sw_js()\n{\n    wp_enqueue_script(\n        'sw-js',\n        home_url('/sw.js'), // Ruta absoluta desde la raíz del dominio\n        array(),\n        '1.0.2',\n        true\n    );\n}\nadd_action('wp_enqueue_scripts', 'encolar_sw_js');\n*/\n\n//esto funciona cuando es local, tiene que sar el rror log de wp pro defecto spara todos los archivos \nfunction escribirLog($mensaje, $archivo = '', $maxlineas = 10000)\n{\n\n    // Intentar usar el error_log de WordPress por defecto\n    if (is_object($mensaje) || is_array($mensaje)) {\n        error_log(print_r($mensaje, true));\n    } else {\n        error_log($mensaje);\n    }\n\n    // Si se especificó un archivo y no estamos en local, intentamos escribir en el\n    if (!empty($archivo) && (!defined('LOCAL') || !LOCAL)) {\n        try {\n            if (!is_writable(dirname($archivo))) {\n                error_log(\"escribirLog: No se puede escribir en el directorio: \" . dirname($archivo));\n                return false;\n            }\n\n            if (is_object($mensaje) || is_array($mensaje)) {\n                $mensaje = print_r($mensaje, true);\n            }\n\n            $log = date('Y-m-d H:i:s') . ' - ' . $mensaje;\n\n            $fp = fopen($archivo, 'a');\n            if ($fp) {\n                if (flock($fp, LOCK_EX)) {\n                    fwrite($fp, $log . PHP_EOL);\n\n                    // Limitar el tamaño del archivo, pero solo si se especificó un archivo\n                    if (rand(1, 10000) === 1) {\n                        $lineas = file($archivo, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);\n                        if (count($lineas) > $maxlineas) {\n                            $lineas = array_slice($lineas, -$maxlineas);\n                            file_put_contents($archivo, implode(PHP_EOL, $lineas) . PHP_EOL);\n                        }\n                    }\n\n                    flock($fp, LOCK_UN);\n                } else {\n                    error_log(\"escribirLog: No se pudo obtener el bloqueo del archivo: $archivo\");\n                }\n                fclose($fp);\n            } else {\n                error_log(\"escribirLog: No se pudo abrir el archivo: $archivo\");\n            }\n        } catch (Exception $e) {\n            error_log(\"escribirLog: Excepción capturada: \" . $e->getMessage());\n            return false;\n        }\n    }\n\n    return true;\n}\n// sudo touch /var/www/wordpress/wp-content/themes/streamLog.log && sudo chown www-data:www-data /var/www/wordpress/wp-content/themes/rendimiento.log && sudo chmod 664 /var/www/wordpress/wp-content/themes/rendimiento.log\n// tail -f /var/www/wordpress/wp-content/themes/rendimiento.log\nfunction streamLog($log)\n{\n    if (STREAM_LOG_ENABLED) {\n        escribirLog($log, '/var/www/wordpress/wp-content/themes/streamLog.log');\n    }\n}\n\n\nfunction seoLog($log)\n{\n    if (SEO_LOG_ENABLED) {\n        escribirLog($log, '/var/www/wordpress/wp-content/themes/seoLog.log');\n    }\n}\n\n\nfunction logAudio($log)\n{\n    if (LOG_AUDIO_ENABLED) {\n        escribirLog($log, '/var/www/wordpress/wp-content/themes/logAudio.log');\n    }\n}\n\nfunction rendimientoLog($log)\n{\n    if (RENDIMIENTO_ENABLED) {\n        escribirLog($log, '/var/www/wordpress/wp-content/themes/rendimiento.log');\n    }\n}\n\nfunction chatLog($log)\n{\n    if (CHAT_LOG_ENABLED && current_user_can('administrator')) {\n        escribirLog($log, '/var/www/wordpress/wp-content/themes/chat.log');\n    }\n}\n\nfunction stripeError($log)\n{\n    if (STRIPE_ERROR_ENABLED && current_user_can('administrator')) {\n        escribirLog($log, '/var/www/wordpress/wp-content/themes/stripeError.log');\n    }\n}\n\nfunction autLog($log)\n{\n    escribirLog($log, '/var/www/wordpress/wp-content/themes/automaticPost.log');\n}\n\nfunction guardarLog($log)\n{\n    if (GUARDAR_LOG_ENABLED) {\n        escribirLog($log, '/var/www/wordpress/wp-content/themes/logsw.txt');\n    }\n}\n\nfunction logAlgoritmo($log)\n{\n    if (LOG_ALGORITMO_ENABLED && current_user_can('administrator')) {\n        escribirLog($log, '/var/www/wordpress/wp-content/themes/logAlgoritmo.log', 100);\n    }\n}\n\nfunction ajaxPostLog($log)\n{\n    if (AJAX_POST_LOG_ENABLED && current_user_can('administrator')) {\n        escribirLog($log, '/var/www/wordpress/wp-content/themes/wanlogAjax.txt');\n    }\n}\n\nfunction iaLog($log)\n{\n    if (IA_LOG_ENABLED && current_user_can('administrator')) {\n        escribirLog($log, '/var/www/wordpress/wp-content/themes/iaLog.log');\n    }\n}\n\nfunction postLog($log)\n{\n    if (POST_LOG_ENABLED && current_user_can('administrator')) {\n        escribirLog($log, '/var/www/wordpress/wp-content/themes/wanlog.txt');\n    }\n}\n\n\n//wave\n\nfunction scriptsOrdenados()\n{\n    $global_version = '0.2.386';\n    $dev_mode = defined('LOCAL') && LOCAL;\n    //$error_log = [];\n\n    $scripts_only_for_logged_in_users = [\n        'galleV2',\n        'likes',\n        'descargas',\n        'RS',\n        'progreso',\n        'configPerfil',\n        'stripeAccion',\n        'likes',\n        'autorows',\n        'stripepro',\n        'subida',\n        'hashs',\n        'ajax-submit',\n        'formsscript',\n        'notificaciones',\n        'colec',\n        'contarVistaPost',\n        'seguir',\n        'inversores',\n        'genericAjax',\n        'comentarios',\n        'stripeCompra',\n        'task',\n        'notas',\n    ];\n\n    $script_handles = [\n        'gloria'            => '1.0.1',\n        'ajaxPage'          => '5.0.11',\n        'autorows'          => '1.0.1',\n        'busqueda'          => '1.0.1',\n        'stripeAccion'      => '1.0.6',\n        'reproductor'       => '2.1.2',\n        'stripepro'         => '1.0.8',\n        'progreso'          => '1.0.23',\n        'modal'             => '1.0.22',\n        'alert'             => '1.0.4',\n        'submenu'           => '1.2.15',\n        'descargas'         => '2.0.1',\n        'pestanas'          => '1.1.10',\n        'tagify'            => '2.0.1',\n        'wavesDos'          => '1.0.1',\n        'configPerfil'      => '1.0.14',\n        'diferido-post'     => '4.0.0',\n        'registro'          => '1.0.12',\n        'colab'             => '1.0.2',\n        'grained'           => '1.0.3',\n        'subida'            => '1.1.21',\n        'RS'                => '1.0.1',\n        'tagsPosts'         => '1.0.1',\n        'hashs'             => '1.0.1',\n        'background'        => '1.0.1',\n        'ajax-submit'       => '2.1.38',\n        'formscript'        => '1.1.11',\n        'genericAjax'       => '2.1.13',\n        'wavejs'            => ['2.0.20', ['jquery', 'wavesurfer']],\n        'inversores'        => '1.0.4',\n        'likes'             => '2.0.1',\n        'seguir'            => '2.0.1',\n        'galleV2'           => '2.0.1',\n        'cambiarVistas'     => '1.0.1',\n        'contarVistaPost'   => '1.0.1',\n        'notificaciones'    => '1.0.1',\n        'comentarios'       => '1.0.1',\n        'colec'             => '1.0.1',\n        'stripeCompra'      => '1.0.1',\n        'tooltips'          => '1.0.1',\n        'masonary'          => '1.0.1',\n        'taskEnter'         => '1.0.1',\n        'taskmove'          => '1.0.1',\n        'taskSesiones'      => '1.0.1',\n        'task'              => '1.0.1',\n        'icons'             => '1.0.1',\n        'notas'             => '1.0.1',\n        'filtros'           => '1.0.1',\n    ];\n\n    wp_enqueue_script('wavesurfer', 'https://unpkg.com/wavesurfer.js', [], '7.8.11', true);\n    // Registro de la configuración inicial\n    //$error_log[] = \"Modo de desarrollo activado: \" . ($dev_mode ? 'Sí' : 'No');\n    //$error_log[] = \"Versión global de scripts: \" . $global_version;\n\n    foreach ($script_handles as $handle => $data) {\n        $version = $global_version;\n        $deps = is_array($data) && isset($data[1]) ? $data[1] : [];\n\n        if (!is_user_logged_in() && in_array($handle, $scripts_only_for_logged_in_users)) {\n            //$error_log[] = \"Usuario no logueado, omitiendo script: \" . $handle;\n            continue;\n        }\n\n        if ($dev_mode) {\n            $version .= '.' . mt_rand();\n        }\n\n        $script_path = get_template_directory() . \"/js/{$handle}.js\";\n        $script_url = get_template_directory_uri() . \"/js/{$handle}.js\";\n\n        // Registro de cada script antes de verificar su existencia\n        //$error_log[] = \"Intentando cargar script: \" . $handle . " desde " . $script_path;\n\n        if (!file_exists($script_path)) {\n            //$error_log[] = \"Error: El archivo \" . $handle . \".js no existe en la ruta: \" . $script_path;\n            continue;\n        }\n\n        wp_enqueue_script($handle, $script_url, $deps, $version, true);\n        //$error_log[] = \"Script \" . $handle . \" encolado correctamente con versión: \" . $version;\n    }\n\n\n    // Scripts adicionales y localizaciones\n    if (is_user_logged_in()) {\n        $nonce = wp_create_nonce('wp_rest');\n        wp_localize_script('galleV2', 'galleV2', [\n            'nonce'     => $nonce,\n            'apiUrl'    => esc_url_raw(rest_url('galle/v2/guardarMensaje/')),\n            'emisor'    => get_current_user_id()\n        ]);\n        //$error_log[] = \"Script galleV2 localizado con nonce y apiUrl para usuario logueado.\";\n\n        wp_enqueue_script('jquery');\n        wp_enqueue_script('chart-js', 'https://cdn.jsdelivr.net/npm/chart.js', [], null, true);\n        wp_enqueue_script('chartjs-adapter-date-fns', 'https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns', ['chart-js'], null, true);\n        //$error_log[] = \"Scripts chart-js y chartjs-adapter-date-fns encolados para usuario logueado.\";\n    }\n\n    wp_localize_script('ajaxPage', 'ajaxPage', ['logeado' => is_user_logged_in()]);\n    //$error_log[] = \"Script ajaxPage localizado.\";\n\n\n\n    wp_add_inline_script('genericAjax', 'const wpAdminUrl = \"' . admin_url() . '\";', 'before');\n    //$error_log[] = \"Script en línea para genericAjax añadido con wpAdminUrl.\";\n\n    // Localización de scripts adicionales\n    $ajax_url = admin_url('admin-ajax.php');\n    $script_localizations = [\n        'subida'                => ['my_ajax_object', ['ajax_url' => $ajax_url]],\n        'social-post-script'    => ['my_ajax_object', ['ajax_url' => $ajax_url, 'social_post_nonce' => wp_create_nonce('social-post-nonce')]],\n        'my-ajax-script'        => ['ajax_params', ['ajax_url' => $ajax_url]],\n        'reproductor'           => ['audioSettings', ['nonce' => wp_create_nonce('wp_rest')]],\n        'wavejs'                => ['audioSettings', ['nonce' => wp_create_nonce('wp_rest'), 'encryptionKey' => $_ENV['AUDIOCLAVE'], 'key' => $_ENV['AUDIOCLAVE'], 'restUrl' => rest_url()]],\n        'form-script'           => ['wpData', ['isAdmin' => current_user_can('administrator')]],\n    ];\n\n    foreach ($script_localizations as $handle => $data) {\n        wp_localize_script($handle, $data[0], $data[1]);\n        //$error_log[] = \"Script \" . $handle . \" localizado con éxito.\";\n    }\n\n    // Registro de errores\n    if (!empty($error_log)) {\n        $log_message = \"Detalles de scriptsOrdenados:\\n\" . implode(\"\\n\", $error_log) . \"\\n\";\n        //error_log($log_message);\n    }\n}\nadd_action('wp_enqueue_scripts', 'scriptsOrdenados');\n\nfunction limpiarLogs()\n{\n    $log_files = array(\n        ABSPATH . 'wp-content/themes/wanlog.txt',\n        ABSPATH . 'wp-content/themes/wanlogAjax.txt',\n        ABSPATH . 'wp-content/uploads/access_logs.txt',\n        ABSPATH . 'wp-content/themes/logsw.txt',\n        ABSPATH . 'wp-content/debug.log'\n    );\n\n    foreach ($log_files as $file) {\n        if (file_exists($file)) {\n            $file_size = filesize($file) / (1024 * 1024); // Size in MB\n\n            if ($file_size > 1) {\n                // Use SplFileObject for memory-efficient file handling\n                try {\n                    $temp_file = $file . '.temp';\n                    $fp_out = fopen($temp_file, 'w');\n\n                    if ($fp_out === false) {\n                        continue;\n                    }\n\n                    $file_obj = new SplFileObject($file, 'r');\n\n                    // Move file pointer to end\n                    $file_obj->seek(PHP_INT_MAX);\n                    $total_lines = $file_obj->key();\n\n                    // Calculate start position for last 2000 lines\n                    $start_line = max(0, $total_lines - 2000);\n\n                    // Reset pointer\n                    $file_obj->rewind();\n\n                    $current_line = 0;\n                    while (!$file_obj->eof()) {\n                        if ($current_line >= $start_line) {\n                            fwrite($fp_out, $file_obj->current());\n                        }\n                        $file_obj->next();\n                        $current_line++;\n                    }\n\n                    fclose($fp_out);\n\n                    // Replace original file with temp file\n                    if (file_exists($temp_file)) {\n                        unlink($file);\n                        rename($temp_file, $file);\n                    }\n                } catch (Exception $e) {\n                    // Log error or handle exception\n                    error_log(\"Error processing log file {$file}: \" . $e->getMessage());\n\n                    // Clean up temp file if it exists\n                    if (isset($temp_file) && file_exists($temp_file)) {\n                        unlink($temp_file);\n                    }\n                }\n            }\n        }\n    }\n}\n\n// Programar la ejecución de la función\nif (!wp_next_scheduled('clean_log_files_hook')) {\n    wp_schedule_event(time(), 'hourly', 'clean_log_files_hook');\n}\nadd_action('clean_log_files_hook', 'limpiarLogs');\n\n\nfunction custom_site_icon($meta_tags)\n{\n    $meta_tags[] = sprintf('<link rel=\"icon\" href=\"%s\">', 'https://2upra.com/wp-content/themes/2upra3v/assets/icons/favicon-96x96.png');\n    return $meta_tags;\n}\nadd_filter('site_icon_meta_tags', 'custom_site_icon');\n\nfunction incluirArchivos($directorio)\n{\n    $ruta_completa = get_template_directory() . \"/$directorio\";\n\n    $archivos = glob($ruta_completa . \"*.php\");\n    foreach ($archivos as $archivo) {\n        include_once $archivo;\n    }\n\n    $subdirectorios = glob($ruta_completa . \"*/\", GLOB_ONLYDIR);\n    foreach ($subdirectorios as $subdirectorio) {\n        $ruta_relativa = str_replace(get_template_directory() . '/', '', $subdirectorio);\n        incluirArchivos($ruta_relativa);\n    }\n}\n\n$directorios = [\n    'app/',\n];\n\nforeach ($directorios as $directorio) {\n    incluirArchivos($directorio);\n}\n\n\n\n// CARGAR LA BARRA DE CARGA\nfunction loadingBar()\n{\n    echo '<style>\n        #loadingBar {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 0%;\n            height: 4px;\n            background-color: white; /* Color de la barra */\n            transition: width 0.4s ease;\n            z-index: 999999999999999;\n        }\n    </style>';\n\n    echo '<div id=\"loadingBar\"></div>';\n}\n\nadd_action('wp_head', 'loadingBar');\n\n//CALCULAR ALTURA CORRECTA CON SCRIPT\nfunction innerHeight()\n{\n    wp_register_script('script-base', '');\n    wp_enqueue_script('script-base');\n    $script_inline = <<<'EOD'\n    function setVHVariable() {\n        var vh;\n        if (window.visualViewport) {\n            vh = window.visualViewport.height * 0.01;\n        } else {\n            vh = window.innerHeight * 0.01;\n        }\n        document.documentElement.style.setProperty('--vh', vh + 'px');\n    }\n\n    document.addEventListener('DOMContentLoaded', function() {\n        setVHVariable();\n\n        if (window.visualViewport) {\n            window.visualViewport.addEventListener('resize', setVHVariable);\n        } else {\n            window.addEventListener('resize', setVHVariable);\n        }\n    });\nEOD;\n    wp_add_inline_script('script-base', $script_inline);\n}\nadd_action('wp_enqueue_scripts', 'innerHeight');\n"
  }
}
2025-03-30 07:50:38 - ERROR - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: No se recibió un RESULTADO válido de Gemini (Paso 2). Abortando ciclo.
2025-03-30 07:50:38 - WARNING - nucleo.manejadorGit.descartarCambiosLocales: descartarCambiosLocales: ¡ATENCIÓN! Intentando descartar todos los cambios locales en /var/www/herramientaRefactor/clonProyecto...
2025-03-30 07:50:38 - INFO - nucleo.manejadorGit.descartarCambiosLocales: descartarCambiosLocales: Cambios locales descartados exitosamente (reset --hard + clean -fdx).
2025-03-30 07:50:38 - INFO - root.guardarHistorial: guardarHistorial: Historial guardado en /var/www/herramientaRefactor/historial_refactor.log (1 entradas).
2025-03-30 07:50:38 - WARNING - root.<module>: Proceso principal finalizó sin realizar un commit efectivo o con errores (revisar historial).
2025-03-30 07:55:54 - INFO - root.configurarLogging: ==================================================
2025-03-30 07:55:54 - INFO - root.configurarLogging: configurarLogging: Sistema de logging configurado.
2025-03-30 07:55:54 - INFO - root.configurarLogging: configurarLogging: Nivel de log establecido a INFO
2025-03-30 07:55:54 - INFO - root.<module>: Iniciando script principal (Dos Pasos Detallado). Modo Test: Activado
2025-03-30 07:55:54 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: ===== INICIO CICLO DE REFACTORIZACIÓN (ENFOQUE DOS PASOS DETALLADO) =====
2025-03-30 07:55:54 - INFO - root.cargarHistorial: cargarHistorial: Historial cargado desde /var/www/herramientaRefactor/historial_refactor.log (0 entradas).
2025-03-30 07:55:54 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Preparando repositorio local...
2025-03-30 07:55:54 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Gestionando repositorio git@github.com:2upra/v4.git en /var/www/herramientaRefactor/clonProyecto (rama objetivo: refactor-test-7)
2025-03-30 07:55:54 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Verificando y/o corrigiendo URL del remote 'origin'...
2025-03-30 07:55:54 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: URL del remote 'origin' ya está configurada correctamente a git@github.com:2upra/v4.git.
2025-03-30 07:55:56 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Rama principal remota detectada: 'main'
2025-03-30 07:55:56 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Limpiando estado del repositorio local...
2025-03-30 07:55:56 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Actualizando referencias remotas (fetch)...
2025-03-30 07:55:57 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Reseteando rama 'main' a 'origin/main'...
2025-03-30 07:55:57 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Limpiando archivos no rastreados (clean)...
2025-03-30 07:55:57 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Asegurando rama de trabajo: 'refactor-test-7'
2025-03-30 07:55:58 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Cambiando a la rama local existente 'refactor-test-7'.
2025-03-30 07:55:58 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Rama 'refactor-test-7' existe localmente pero no en origin. Se usará la versión local.
2025-03-30 07:55:58 - INFO - nucleo.manejadorGit.clonarOActualizarRepo: clonarOActualizarRepo: Repositorio actualizado y en la rama 'refactor-test-7'.
2025-03-30 07:55:58 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Repositorio listo y en la rama 'refactor-test-7'.
2025-03-30 07:55:58 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: --- INICIO PASO 1: ANÁLISIS Y DECISIÓN DETALLADA ---
2025-03-30 07:55:58 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Analizando código COMPLETO del proyecto en /var/www/herramientaRefactor/clonProyecto...
2025-03-30 07:55:58 - INFO - nucleo.analizadorCodigo.listarArchivosProyecto: listarArchivosProyecto: Listando archivos en: /var/www/herramientaRefactor/clonProyecto
2025-03-30 07:55:58 - INFO - nucleo.analizadorCodigo.listarArchivosProyecto: listarArchivosProyecto: Archivos relevantes encontrados: 233
2025-03-30 07:55:58 - INFO - nucleo.analizadorCodigo.leerArchivos: leerArchivos: Leídos 233 archivos. Tamaño total: 1664.14 KB
2025-03-30 07:55:58 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Código fuente completo leído (233 archivos, 1690.72 KB).
2025-03-30 07:55:58 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Obteniendo DECISIÓN DETALLADA de Gemini (modelo: gemini-2.0-flash-thinking-exp-01-21)...
2025-03-30 07:55:58 - INFO - nucleo.analizadorCodigo.configurarGemini: configurarGemini: Cliente de Gemini configurado.
2025-03-30 07:55:58 - INFO - nucleo.analizadorCodigo.obtenerDecisionRefactor: obtenerDecisionRefactor (Paso 1): Usando modelo Gemini: gemini-2.0-flash-thinking-exp-01-21
2025-03-30 07:55:58 - INFO - nucleo.analizadorCodigo.obtenerDecisionRefactor: obtenerDecisionRefactor (Paso 1): Enviando solicitud de DECISIÓN detallada a Gemini...
2025-03-30 07:56:29 - INFO - nucleo.analizadorCodigo.obtenerDecisionRefactor: obtenerDecisionRefactor (Paso 1): Respuesta de DECISIÓN recibida.
2025-03-30 07:56:29 - INFO - nucleo.analizadorCodigo._limpiarYParsearJson: obtenerDecisionRefactor (Paso 1): JSON parseado correctamente.
2025-03-30 07:56:29 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Parseando DECISIÓN DETALLADA de Gemini...
2025-03-30 07:56:29 - INFO - root.parsearDecisionGemini: parsearDecisionGemini: Decisión parseada exitosamente. Acción: mover_funcion. Archivos relevantes: ['functions.php', 'TemplateInicio.php', 'TemplateFeedSample.php', 'TemplateBiblioteca.php', 'TemplateBusqueda.php', 'TemplateTask.php', 'TemplateFeed.php', 'TemplateColab.php', 'TemplateAsley.php']. Razonamiento: 1. Observación: La función `obtenerIdiomaDelNavegador()` y la lógica para definir el título y la des...
2025-03-30 07:56:29 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Razonamiento del Paso 1:
1. Observación: La función `obtenerIdiomaDelNavegador()` y la lógica para definir el título y la descripción de la página se repiten en varios archivos de plantilla (TemplateInicio.php, TemplateFeedSample.php, TemplateBiblioteca.php, TemplateBusqueda.php, TemplateTask.php, TemplateFeed.php, TemplateColab.php, TemplateAsley.php).
2. Justificación: La duplicación de código dificulta el mantenimiento y la consistencia. Refactorizar esta lógica en una función reutilizable en `functions.php` mejorará la cohesión y reducirá la redundancia.
3. Acción Específica: Mover la función `obtenerIdiomaDelNavegador()` y la lógica de título/descripción a `functions.php`. Crear una nueva función en `functions.php` llamada `configurarTituloDescripcion` que encapsule la lógica de detección de idioma y configuración de título/descripción. Modificar los archivos de plantilla para llamar a esta nueva función.
4. Impacto Esperado: Reducción de la duplicación de código, mejora de la mantenibilidad y la legibilidad del código.
5. Riesgos/Consideraciones: Asegurarse de que la refactorización no altere la funcionalidad existente y que la nueva función sea correctamente llamada en todas las plantillas afectadas.
6. Código a Eliminar (si aplica): El código duplicado de la función `obtenerIdiomaDelNavegador()` y la lógica de título/descripción de los archivos de plantilla.
2025-03-30 07:56:29 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: --- FIN PASO 1: Decisión válida recibida: mover_funcion ---
2025-03-30 07:56:29 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: --- INICIO PASO 2: EJECUCIÓN PRECISA ---
2025-03-30 07:56:29 - INFO - nucleo.analizadorCodigo.leerArchivos: leerArchivos: Leídos 9 archivos. Tamaño total: 41.36 KB
2025-03-30 07:56:29 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Contexto reducido leído (9 archivos: ['functions.php', 'TemplateInicio.php', 'TemplateFeedSample.php', 'TemplateBiblioteca.php', 'TemplateBusqueda.php', 'TemplateTask.php', 'TemplateFeed.php', 'TemplateColab.php', 'TemplateAsley.php'], 42.29 KB).
2025-03-30 07:56:29 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Obteniendo RESULTADO de ejecución de Gemini (contexto reducido, siguiendo decisión)...
2025-03-30 07:56:29 - INFO - nucleo.analizadorCodigo.ejecutarAccionConGemini: ejecutarAccionConGemini (Paso 2): Usando modelo Gemini: gemini-2.0-flash-thinking-exp-01-21
2025-03-30 07:56:29 - INFO - nucleo.analizadorCodigo.ejecutarAccionConGemini: ejecutarAccionConGemini (Paso 2): Enviando solicitud de EJECUCIÓN precisa a Gemini...
2025-03-30 07:57:08 - INFO - nucleo.analizadorCodigo.ejecutarAccionConGemini: ejecutarAccionConGemini (Paso 2): Respuesta de EJECUCIÓN recibida.
2025-03-30 07:57:08 - INFO - nucleo.analizadorCodigo._limpiarYParsearJson: ejecutarAccionConGemini (Paso 2): JSON parseado correctamente.
2025-03-30 07:57:08 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Parseando RESULTADO de ejecución de Gemini...
2025-03-30 07:57:08 - INFO - root.parsearResultadoEjecucion: parsearResultadoEjecucion: Resultado de ejecución parseado exitosamente. 9 archivo(s) a modificar/crear.
2025-03-30 07:57:08 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: --- FIN PASO 2: Resultado de ejecución válido recibido (9 archivos a modificar/crear). ---
2025-03-30 07:57:08 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Aplicando cambios generados por Gemini (Paso 2)...
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Aplicando cambios para acción original 'mover_funcion'...
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Sobrescribiendo/Creando 9 archivo(s)...
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Archivo 'functions.php' escrito/sobrescrito correctamente.
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Archivo 'TemplateInicio.php' escrito/sobrescrito correctamente.
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Archivo 'TemplateFeedSample.php' escrito/sobrescrito correctamente.
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Archivo 'TemplateBiblioteca.php' escrito/sobrescrito correctamente.
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Archivo 'TemplateBusqueda.php' escrito/sobrescrito correctamente.
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Archivo 'TemplateTask.php' escrito/sobrescrito correctamente.
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Archivo 'TemplateFeed.php' escrito/sobrescrito correctamente.
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Archivo 'TemplateColab.php' escrito/sobrescrito correctamente.
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Archivo 'TemplateAsley.php' escrito/sobrescrito correctamente.
2025-03-30 07:57:08 - INFO - nucleo.aplicadorCambios.aplicarCambiosSobrescritura: aplicarCambiosSobrescritura: Todos los archivos (9) fueron procesados.
2025-03-30 07:57:08 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Cambios aplicados localmente con éxito.
2025-03-30 07:57:08 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Realizando commit en rama 'refactor-test-7'...
2025-03-30 07:57:08 - WARNING - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Mensaje de commit (línea única) excede los 72 caracteres.
2025-03-30 07:57:08 - INFO - nucleo.manejadorGit.hacerCommit: hacerCommit: Intentando commit en /var/www/herramientaRefactor/clonProyecto
2025-03-30 07:57:08 - INFO - nucleo.manejadorGit.hacerCommit: hacerCommit: Realizando commit con mensaje: 'Refactor: Mueve función `obtenerIdiomaDelNavegador` y lógica de título/descripción a `functions.php` para reutilización.'
2025-03-30 07:57:08 - INFO - nucleo.manejadorGit.hacerCommit: hacerCommit: Commit realizado con éxito.
2025-03-30 07:57:08 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Verificando si el commit introdujo cambios efectivos...
2025-03-30 07:57:08 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Commit realizado con éxito y contiene cambios efectivos.
2025-03-30 07:57:08 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: Ciclo completado con éxito. Registrando en historial.
2025-03-30 07:57:08 - INFO - root.guardarHistorial: guardarHistorial: Historial guardado en /var/www/herramientaRefactor/historial_refactor.log (1 entradas).
2025-03-30 07:57:08 - INFO - root.ejecutarProcesoPrincipal: ejecutarProcesoPrincipal: ===== FIN CICLO DE REFACTORIZACIÓN (Commit efectivo realizado) =====
2025-03-30 07:57:08 - INFO - root.<module>: Proceso principal completado: Se realizó un commit con cambios efectivos.
2025-03-30 07:57:08 - INFO - root.<module>: Modo Test activado: Intentando hacer push...
2025-03-30 07:57:08 - INFO - nucleo.manejadorGit.hacerPush: hacerPush: Intentando push de la rama 'refactor-test-7' a 'origin' desde /var/www/herramientaRefactor/clonProyecto
2025-03-30 07:57:10 - INFO - nucleo.manejadorGit.hacerPush: hacerPush: Push de la rama 'refactor-test-7' a origin realizado con éxito.
2025-03-30 07:57:10 - INFO - root.<module>: Modo Test: Push a la rama 'refactor-test-7' realizado con éxito.
